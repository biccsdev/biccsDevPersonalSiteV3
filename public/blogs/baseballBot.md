I was doing my daily news reading, when I stumbled across an [article from tech crunch](https://techcrunch.com/2023/10/27/instagram-head-says-threads-api-is-in-the-works/), the title said **“Instagram head says Threads API is in the works”**, which I found quite interesting, several thoughts came to my mind and one of them was **“It would be cool to automate a Threads account”**, then I remembered a that a friend of mine runs the largest X ( aka Twitter ) account for my city’s baseball team, I asked him about his threads presence, but as I expected he doesn’t use it at all, he created it at the very top of the app’s hyped momentum and never came back. Then I asked him about his twitter account which he uses regularly [@Ganaroncaneros](https://twitter.com/ganaroncaneros), ( team which btw won the championship of the biggest league in Mexico last season ). In this account he tweets ‘Yes’ or ‘No’ whether the team wins their latest game or not, a simple concept but quite useful for fans. I thought–How about I automate my friend’s twitter account? I know the task of tweeting the outcome of the game takes him little to no time, but most of the times the games end up finishing very late at night, and I know he needs to sleep early-ish because of work, he sometimes asks somebody else to keep track of the outcome of the game for him, as he needs to call it a day, this implies giving access to the account to external persons, and overall relying on somebody else to tweet the outcome of the game. I went ahead and pitched the idea to him which he loved. This would save me from extra work and it would be nice to have it automated, he said. Also, this would be a lot of fun for me as I would delve into some technical concepts I’ve been wanting to get my hands into for some time now. As if I didn’t have enough backlog in my personal projects queue, I decided to add a new one, for a moment my personal projects queue turned into a stack because I started this project as soon as it came into my mind.

Now with this new task at hand, I put my mind into it. I needed to build a twitter bot that retrieved the data from a data source, at first hand I thought about using an API that provided me with the data of the current game taking place, but after spending about an hour looking for an API that would be useful for this use case I realized that there was none. Then an idea popped up in my head, how about I finally try web scraping. For those who don't know, **“Web Scraping”** is basically a technique that allows an individual to extract information from a website using HTTP ( the protocol that runs the Internet ). I have never used this technique prior working on this project so it was a no brainer. On one side this would be the only way I could get my hands on the information I needed and on the other side, trying and learning new things fills my soul.

Okay, now that the data gathering technique was settled, I went ahead and identified the website from which I was going to scrape the data, first thought was to retrieve the information from the official league’s website, but upon analyzing their HTML my noob brain couldn't figure a way to efficiently retrieve the data from the site, as they were dynamically rendering the data that I needed to retrieve, also their div tags didn't have any classes on them, so I thought that I couldn’t properly retrieve the data, without giving more thought to that matter I started looking for other websites to retrieve the data from, which for my surprise I found a pretty well outlined HTML in the official website of the team I wanted to retrieve the data for, next to their navbar they have a table tag with three rows, one for the status of the game and the column headers to the score and other data, and the other two rows with the data itself.

After talking with my friend we identified the requirements of the bot, which were:

- The bot needs to retrieve the game’s data (status of the game, home score and visitor score)
- The bot needs to correctly identify the score of each team
- The bot needs to correctly identify which team won the match
- The bot needs to tweet ‘Yes’ or ‘No’ ONCE every time a game ends, accordingly to the outcome of the game for the team in question

Now, with the requirements defined, I started to design the solution and came up with the following package diagram.
![UML Package diagram for this project](/blogImage/baseballBot/packageDiagramBotBaseball.jpeg)

- **Index.js** - Glues everything together inside a cron job that executes the data fetching every 5 minutes, and performs the tweeting once the game is done
- **Scrape.js** - Scrapes the data from the website and performs the business logic to analyze and retrieve the correct data as the positions of the teams on the table can change if they are playing home or are visitors
- **HelperStore.js** - exports two functions, one reads from and the other updates our json file
- **TweetState.json** - stores the state of whether the last game’s tweet has been sent, it allows data persistency across raspberry pi’s boots, in case it is turned off and on I don’t lose state
- **TwitterConfig.js** - Creates and exports the connection with the twitter account

Then, I went ahead and opened my Ubuntu terminal, created a new directory, typed `npm init`, and created the Node.js project. Want to see the code? Visit the [GitHub repo](https://github.com/biccsdev/baseball_twitter_bot).

Finally it was time to deploy. I knew that I wanted to host the bot locally, didn’t want to use the cloud ( someone else’s computer XD ), so I planned the architecture to be self-contained in a microcontroller, at first thought about using an esp32 devkit and flash it with [Espruino](https://www.espruino.com/) ( a Javascript environment for microcontrollers ), but it didn’t feel right for some reason haha, so my next thought was to use my old reliable raspberry pi 4B, It had been a while since the last time that I used it so it made perfect sense to host the bot there. This decision led me to a little bit of friction as I was trying to deploy the bot on the Pi, Node versions management happened, it was a little bit of a headache, I didn’t have Node or Npm installed in my Pi prior to this project, so I went ahead and ran `sudo apt install node` and `sudo apt install npm`, for which I got a kinda old version of these tools, the bot was written with Node v16.14.2 and the Pi installed some v10 version of node and v5 or so version of npm, so when I tried to run it, it just didn’t work, so what I did next was update node and npm to the latest versions which to my surprise didn’t work either xD as raspbian OS, couldn’t support certain package that was required to run node v20 which was the latest stable version, the reason being the architecture of the raspberry pi’s CPU, I went ahead and installed the specific version of node ( v16.14.2) with which the project was written and I was good to go.

At last the bot was alive! By the time of writing this article it had tweeted 3 times and all the games had been won, coincidence? I don’t think so ;) ( “Si” means Yes in Spanish )
![Screenshot from the twitter account](/blogImage/baseballBot/ganaronTweet.png)

#### Thanks for reaching the end of this article! :D
